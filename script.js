const aboutData = {
  1: {
    title: "DIR/FLOORTIME®: Coaching Caregivers & Teachers",
    list: [
      {
        title:
          "DIR/FLOORTIME®: Phương pháp DIR/Floortime được sáng lập bởi bác sĩ Stanley Greenspan, đại học Havard và Yale, cùng với tiến sĩ Serena Wieder, đại học New York. Phương pháp này chú trọng vào 6 năng lực phát triển cảm xúc ở tất cả trẻ em, đặc biệt là các em Phổ Tự Kỷ.",
        icon: "images/heart.png",
      },
      {
        title:
          "DIR/FLOORTIME®: Phương pháp DIR/Floortime được sáng lập bởi bác sĩ Stanley Greenspan, đại học Havard và Yale, cùng với tiến sĩ Serena Wieder, đại học New York. Phương pháp này chú trọng vào 6 năng lực phát triển cảm xúc ở tất cả trẻ em, đặc biệt là các em Phổ Tự Kỷ.",
        icon: "images/heart.png",
      },
    ],
  },
  2: {
    title: "Parent-Child Interaction Therapy (PCIT)",
    list: [
      {
        title:
          "DIR/FLOORTIME®: Phương pháp DIR/Floortime được sáng lập bởi bác sĩ Stanley Greenspan, đại học Havard và Yale, cùng với tiến sĩ Serena Wieder, đại học New York. Phương pháp này chú trọng vào 6 năng lực phát triển cảm xúc ở tất cả trẻ em, đặc biệt là các em Phổ Tự Kỷ.",
        icon: "images/heart.png",
      },
      {
        title:
          "DIR/FLOORTIME®: Phương pháp DIR/Floortime được sáng lập bởi bác sĩ Stanley Greenspan, đại học Havard và Yale, cùng với tiến sĩ Serena Wieder, đại học New York. Phương pháp này chú trọng vào 6 năng lực phát triển cảm xúc ở tất cả trẻ em, đặc biệt là các em Phổ Tự Kỷ.",
        icon: "images/heart.png",
      },
    ],
  },
  3: {
    title: "Touchpoints: The How of Child and Family Engagement",
    list: [
      {
        title:
          "DIR/FLOORTIME®: Phương pháp DIR/Floortime được sáng lập bởi bác sĩ Stanley Greenspan, đại học Havard và Yale, cùng với tiến sĩ Serena Wieder, đại học New York. Phương pháp này chú trọng vào 6 năng lực phát triển cảm xúc ở tất cả trẻ em, đặc biệt là các em Phổ Tự Kỷ.",
        icon: "images/heart.png",
      },
      {
        title:
          "DIR/FLOORTIME®: Phương pháp DIR/Floortime được sáng lập bởi bác sĩ Stanley Greenspan, đại học Havard và Yale, cùng với tiến sĩ Serena Wieder, đại học New York. Phương pháp này chú trọng vào 6 năng lực phát triển cảm xúc ở tất cả trẻ em, đặc biệt là các em Phổ Tự Kỷ.",
        icon: "images/heart.png",
      },
    ],
  },
  4: {
    title: "Mentalization-Based Treatment for Children (MBT-C)",
    list: [
      {
        title:
          "DIR/FLOORTIME®: Phương pháp DIR/Floortime được sáng lập bởi bác sĩ Stanley Greenspan, đại học Havard và Yale, cùng với tiến sĩ Serena Wieder, đại học New York. Phương pháp này chú trọng vào 6 năng lực phát triển cảm xúc ở tất cả trẻ em, đặc biệt là các em Phổ Tự Kỷ.",
        icon: "images/heart.png",
      },
      {
        title:
          "DIR/FLOORTIME®: Phương pháp DIR/Floortime được sáng lập bởi bác sĩ Stanley Greenspan, đại học Havard và Yale, cùng với tiến sĩ Serena Wieder, đại học New York. Phương pháp này chú trọng vào 6 năng lực phát triển cảm xúc ở tất cả trẻ em, đặc biệt là các em Phổ Tự Kỷ.",
        icon: "images/heart.png",
      },
    ],
  },
  5: {
    title: "The PLAY Project - Play & Language for Autistic Youngsters",
    list: [
      {
        title:
          "DIR/FLOORTIME®: Phương pháp DIR/Floortime được sáng lập bởi bác sĩ Stanley Greenspan, đại học Havard và Yale, cùng với tiến sĩ Serena Wieder, đại học New York. Phương pháp này chú trọng vào 6 năng lực phát triển cảm xúc ở tất cả trẻ em, đặc biệt là các em Phổ Tự Kỷ.",
        icon: "images/heart.png",
      },
      {
        title:
          "DIR/FLOORTIME®: Phương pháp DIR/Floortime được sáng lập bởi bác sĩ Stanley Greenspan, đại học Havard và Yale, cùng với tiến sĩ Serena Wieder, đại học New York. Phương pháp này chú trọng vào 6 năng lực phát triển cảm xúc ở tất cả trẻ em, đặc biệt là các em Phổ Tự Kỷ.",
        icon: "images/heart.png",
      },
    ],
  },
  6: {
    title: "Accredited Triple P Provider, Levels 2, 3, 4, 5",
    list: [
      {
        title:
          "DIR/FLOORTIME®: Phương pháp DIR/Floortime được sáng lập bởi bác sĩ Stanley Greenspan, đại học Havard và Yale, cùng với tiến sĩ Serena Wieder, đại học New York. Phương pháp này chú trọng vào 6 năng lực phát triển cảm xúc ở tất cả trẻ em, đặc biệt là các em Phổ Tự Kỷ.",
        icon: "images/heart.png",
      },
      {
        title:
          "DIR/FLOORTIME®: Phương pháp DIR/Floortime được sáng lập bởi bác sĩ Stanley Greenspan, đại học Havard và Yale, cùng với tiến sĩ Serena Wieder, đại học New York. Phương pháp này chú trọng vào 6 năng lực phát triển cảm xúc ở tất cả trẻ em, đặc biệt là các em Phổ Tự Kỷ.",
        icon: "images/heart.png",
      },
    ],
  },
  7: {
    title: "The Incredible Years: Parents, Teachers, and Children Training",
    list: [
      {
        title:
          "DIR/FLOORTIME®: Phương pháp DIR/Floortime được sáng lập bởi bác sĩ Stanley Greenspan, đại học Havard và Yale, cùng với tiến sĩ Serena Wieder, đại học New York. Phương pháp này chú trọng vào 6 năng lực phát triển cảm xúc ở tất cả trẻ em, đặc biệt là các em Phổ Tự Kỷ.",
        icon: "images/heart.png",
      },
      {
        title:
          "DIR/FLOORTIME®: Phương pháp DIR/Floortime được sáng lập bởi bác sĩ Stanley Greenspan, đại học Havard và Yale, cùng với tiến sĩ Serena Wieder, đại học New York. Phương pháp này chú trọng vào 6 năng lực phát triển cảm xúc ở tất cả trẻ em, đặc biệt là các em Phổ Tự Kỷ.",
        icon: "images/heart.png",
      },
    ],
  },
  8: {
    title: "Circle of Security Parenting™ (COSP) program facilitator",
    list: [
      {
        title:
          "DIR/FLOORTIME®: Phương pháp DIR/Floortime được sáng lập bởi bác sĩ Stanley Greenspan, đại học Havard và Yale, cùng với tiến sĩ Serena Wieder, đại học New York. Phương pháp này chú trọng vào 6 năng lực phát triển cảm xúc ở tất cả trẻ em, đặc biệt là các em Phổ Tự Kỷ.",
        icon: "images/heart.png",
      },
      {
        title:
          "DIR/FLOORTIME®: Phương pháp DIR/Floortime được sáng lập bởi bác sĩ Stanley Greenspan, đại học Havard và Yale, cùng với tiến sĩ Serena Wieder, đại học New York. Phương pháp này chú trọng vào 6 năng lực phát triển cảm xúc ở tất cả trẻ em, đặc biệt là các em Phổ Tự Kỷ.",
        icon: "images/heart.png",
      },
    ],
  },
  9: {
    title: "Trauma-Focused Cognitive Behavioral Therapy (TF-CBT)",
    list: [
      {
        title:
          "DIR/FLOORTIME®: Phương pháp DIR/Floortime được sáng lập bởi bác sĩ Stanley Greenspan, đại học Havard và Yale, cùng với tiến sĩ Serena Wieder, đại học New York. Phương pháp này chú trọng vào 6 năng lực phát triển cảm xúc ở tất cả trẻ em, đặc biệt là các em Phổ Tự Kỷ.",
        icon: "images/heart.png",
      },
      {
        title:
          "DIR/FLOORTIME®: Phương pháp DIR/Floortime được sáng lập bởi bác sĩ Stanley Greenspan, đại học Havard và Yale, cùng với tiến sĩ Serena Wieder, đại học New York. Phương pháp này chú trọng vào 6 năng lực phát triển cảm xúc ở tất cả trẻ em, đặc biệt là các em Phổ Tự Kỷ.",
        icon: "images/heart.png",
      },
    ],
  },
  10: {
    title: "ZERO TO THREE: Professional Development",
    list: [
      {
        title:
          "DIR/FLOORTIME®: Phương pháp DIR/Floortime được sáng lập bởi bác sĩ Stanley Greenspan, đại học Havard và Yale, cùng với tiến sĩ Serena Wieder, đại học New York. Phương pháp này chú trọng vào 6 năng lực phát triển cảm xúc ở tất cả trẻ em, đặc biệt là các em Phổ Tự Kỷ.",
        icon: "images/heart.png",
      },
      {
        title:
          "DIR/FLOORTIME®: Phương pháp DIR/Floortime được sáng lập bởi bác sĩ Stanley Greenspan, đại học Havard và Yale, cùng với tiến sĩ Serena Wieder, đại học New York. Phương pháp này chú trọng vào 6 năng lực phát triển cảm xúc ở tất cả trẻ em, đặc biệt là các em Phổ Tự Kỷ.",
        icon: "images/heart.png",
      },
    ],
  },
};

const videoData = [
  {
    youtubeId: "-AG1bohNAT4",
    title:
      "[Tập 1/6] Tư Ký Không Phải Là Bệnh, Mà Là Một Cách Vận Hành Khác Biệt",
  },
  {
    youtubeId: "CL13X-8o4h0",
    title: "Nuôi Con Cùng Ông Bà, Hoá Giải 5 Bất Đồng Phổ Biến",
  },
  {
    youtubeId: "kJQP7kiw5Fk",
    title: "3 Lầm Tưởng Về Phát Triển Trí Não, Ngôn Ngữ, Tính Cách Trẻ Nhỏ",
  },
  {
    youtubeId: "OYvopjXjVPQ",
    title: 'Làm Cha Mẹ Cần "Kỹ Thuật" Gì? Có Thể "Làm Bạn" Với Con?',
  },
  {
    youtubeId: "vxnXky7jbNA",
    title: 'Nhận Diện "Lì Xì", Nói Chuyện "Dạy Con Về Tiền Bạc"',
  },
  {
    youtubeId: "RDfwGkasp58",
    title: "Kỷ Luật Tích Cực Như Đèn Giao Thông: Xây Dựng Sự Tự Giác Cho Con",
  },
];

const podcastData = [
  {
    id: 1,
    title:
      "#60 Nuôi Con Cùng Ông Bà: Hóa Giải 5 Bất Đồng khi Dạy Con - Làm Sao Để Không Căng Thẳng?",
    subtitle: "Happy Parenting with Tu-Anh Nguyen",
    image:
      "https://s3-alpha-sig.figma.com/img/83a1/bd9d/dfe9f5b9b60bc0c2b1bbd55616437242?Expires=1743379200&Key-Pair-Id=APKAQ4GOSFWCW27IBOMQ&Signature=f4slq5q3tIu0mXNsMUYEO22XSVuoieMTJI3W7VwD9ga6a~KQKhqqrsfoH--Ai1HZQbQ34cKGZUkL7AbiHEKPC4tbcSV2Ytzasj9h4DDV44Q4~nBmKa21rX08fpCBoK2IqWMRhY459DqtPHV0~S7sfFwvWI6HRznr5htu9jFUOfwxbh6HEi7ErrwToSxwarkTALS3xD7y4SNbEzpx~KmDg0a~O7rCsAZkbN3eGZg3wxZ4GDWAZHqNaxPMBUD40Ndt8IX5eloptj2h74Wq0WTQyjdzF09h8YSwndlrdcQV5Egnq1o-OK4nang3AR3sX23pT1QiyewMc~iaHjWN6cn34A__",
    audioUrl:
      "https://audio.buzzsprout.com/msh0y7kn19cpn0p1xq77j0pbtwy4?response-content-disposition=inline&client_source=large_player",
  },
  {
    id: 2,
    title:
      "#59 Giải Mã 3 Lầm Tưởng Về Phát Triển Trí Não, Ngôn Ngữ, Tính Cách Trẻ Nhỏ...",
    subtitle: "Happy Parenting with Tu-Anh Nguyen",
    image:
      "https://s3-alpha-sig.figma.com/img/83a1/bd9d/dfe9f5b9b60bc0c2b1bbd55616437242?Expires=1743379200&Key-Pair-Id=APKAQ4GOSFWCW27IBOMQ&Signature=f4slq5q3tIu0mXNsMUYEO22XSVuoieMTJI3W7VwD9ga6a~KQKhqqrsfoH--Ai1HZQbQ34cKGZUkL7AbiHEKPC4tbcSV2Ytzasj9h4DDV44Q4~nBmKa21rX08fpCBoK2IqWMRhY459DqtPHV0~S7sfFwvWI6HRznr5htu9jFUOfwxbh6HEi7ErrwToSxwarkTALS3xD7y4SNbEzpx~KmDg0a~O7rCsAZkbN3eGZg3wxZ4GDWAZHqNaxPMBUD40Ndt8IX5eloptj2h74Wq0WTQyjdzF09h8YSwndlrdcQV5Egnq1o-OK4nang3AR3sX23pT1QiyewMc~iaHjWN6cn34A__",
    audioUrl:
      "https://audio.buzzsprout.com/msh0y7kn19cpn0p1xq77j0pbtwy4?response-content-disposition=inline&client_source=large_player",
  },
  {
    id: 3,
    title:
      "#58 Làm Cha Mẹ: Là Làm Gì? - Là Người Làm Vườn? Hay Là Làm Bạn Của Con?",
    subtitle: "Happy Parenting with Tu-Anh Nguyen",
    image:
      "https://s3-alpha-sig.figma.com/img/83a1/bd9d/dfe9f5b9b60bc0c2b1bbd55616437242?Expires=1743379200&Key-Pair-Id=APKAQ4GOSFWCW27IBOMQ&Signature=f4slq5q3tIu0mXNsMUYEO22XSVuoieMTJI3W7VwD9ga6a~KQKhqqrsfoH--Ai1HZQbQ34cKGZUkL7AbiHEKPC4tbcSV2Ytzasj9h4DDV44Q4~nBmKa21rX08fpCBoK2IqWMRhY459DqtPHV0~S7sfFwvWI6HRznr5htu9jFUOfwxbh6HEi7ErrwToSxwarkTALS3xD7y4SNbEzpx~KmDg0a~O7rCsAZkbN3eGZg3wxZ4GDWAZHqNaxPMBUD40Ndt8IX5eloptj2h74Wq0WTQyjdzF09h8YSwndlrdcQV5Egnq1o-OK4nang3AR3sX23pT1QiyewMc~iaHjWN6cn34A__",
    audioUrl:
      "https://audio.buzzsprout.com/msh0y7kn19cpn0p1xq77j0pbtwy4?response-content-disposition=inline&client_source=large_player",
  },
];

// Utility functions
const Utils = {
  debounce(func, wait) {
    let timeout;
    return function executedFunction(...args) {
      const later = () => {
        clearTimeout(timeout);
        func(...args);
      };
      clearTimeout(timeout);
      timeout = setTimeout(later, wait);
    };
  },

  isMobile() {
    return window.innerWidth <= 768;
  },
};

// FAQ Component
class FAQ {
  constructor() {
    this.faqItems = document.querySelectorAll(".faq-item");
    this.init();
  }

  init() {
    this.faqItems.forEach((item) => {
      const question = item.querySelector(".faq-question");
      question.addEventListener("click", () => this.toggleFAQ(item));
    });
  }

  toggleFAQ(item) {
    const isActive = item.classList.contains("active");
    const answer = item.querySelector(".faq-answer");

    this.faqItems.forEach((otherItem) => {
      if (otherItem !== item && otherItem.classList.contains("active")) {
        otherItem.classList.remove("active");
        otherItem.querySelector(".faq-answer").style.maxHeight = "0";
      }
    });

    if (!isActive) {
      item.classList.add("active");
      const height = answer.querySelector("p").offsetHeight + 40;
      answer.style.maxHeight = `${height}px`;
    } else {
      item.classList.remove("active");
      answer.style.maxHeight = "0";
    }
  }
}

// Testimonials Component
class Testimonials {
  constructor() {
    this.swiperConfig = {
      slidesPerView: "auto",
      spaceBetween: 24,
      loop: false,
      // autoplay: {
      //   delay: 30000,
      //   disableOnInteraction: false,
      //   stopOnLastSlide: true,
      // },
      navigation: {
        nextEl: ".button-next",
        prevEl: ".button-prev",
      },
      speed: 800,
      effect: "slide",
      observer: true,
      observeParents: true,
      resizeObserver: true,
      breakpoints: {
        320: {
          slidesPerView: 1,
          spaceBetween: 16,
        },
        768: {
          slidesPerView: 1.5,
          spaceBetween: 20,
        },
        1024: {
          slidesPerView: 2,
          spaceBetween: 24,
        },
        1200: {
          slidesPerView: 2.2,
          spaceBetween: 24,
        },
      },
      centeredSlides: false,
      grabCursor: true,
      on: {
        init: () => {},
        slideChange: () => {},
        resize: () => {
          this.swiper.update();
          this.updateSwiperContainer();
        },
      },
    };

    this.init();
  }

  init() {
    this.swiper = new Swiper(".testimonials-swiper", this.swiperConfig);
    this.updateSwiperContainer();
    this.setupResizeListener();
  }

  updateSwiperContainer() {
    const container = document.querySelector(".testimonials-swiper");
    const windowWidth = window.innerWidth;
    const containerWidth = document.querySelector(".container").offsetWidth;

    if (windowWidth <= 768) {
      container.style.width = "100%";
      container.style.paddingRight = "0";
    } else {
      const extraWidth = (windowWidth - containerWidth) / 2;
      container.style.width = `calc(100% + ${extraWidth}px)`;
      container.style.paddingRight = `${extraWidth}px`;
    }
  }

  setupResizeListener() {
    window.addEventListener(
      "resize",
      Utils.debounce(() => {
        this.swiper.update();
        this.updateSwiperContainer();
      }, 250)
    );
  }
}

// Certificate Component
class Certificate {
  constructor() {
    this.swiperConfig = {
      slidesPerView: 1,
      spaceBetween: 24,
      loop: false,
      pagination: {
        el: ".certificate-pagination",
        clickable: true,
        type: "bullets",
      },
      navigation: {
        nextEl: ".certificate-next",
        prevEl: ".certificate-prev",
      },
      speed: 800,
      observer: true,
      observeParents: true,
      resizeObserver: true,
      breakpoints: {
        768: {
          slidesPerView: 2,
          spaceBetween: 24,
        },
        1024: {
          slidesPerView: 3,
          spaceBetween: 24,
        },
      },
      on: {
        init: () => {},
        slideChange: () => {},
        resize: () => {
          this.swiper.update();
        },
      },
    };

    this.init();
  }

  init() {
    this.swiper = new Swiper(".certificate-swiper", this.swiperConfig);
  }
}

// Gallery Component
class Gallery {
  constructor() {
    this.swiperConfig = {
      slidesPerView: "auto",
      spaceBetween: 32,
      loop: false,
      navigation: {
        nextEl: ".button-next-gallery",
        prevEl: ".button-prev-gallery",
      },
      speed: 800,
      observer: true,
      observeParents: true,
      resizeObserver: true,
      breakpoints: {
        768: {
          spaceBetween: 24,
        },
      },
      on: {
        init: () => {},
        slideChange: () => {},
        resize: () => {
          this.swiper.update();
        },
      },
    };

    this.init();
  }

  init() {
    this.swiper = new Swiper(".gallery-swiper", this.swiperConfig);
  }
}

// Event Component
class Event {
  constructor() {
    this.swiperConfig = {
      slidesPerView: 1,
      spaceBetween: 16,
      loop: false,
      pagination: {
        el: ".event-pagination",
        clickable: true,
        type: "bullets",
      },
      navigation: {
        nextEl: ".button-next-event",
        prevEl: ".button-prev-event",
      },
      speed: 1000,
      observer: true,
      observeParents: true,
      resizeObserver: true,
      on: {
        init: () => {},
        slideChange: () => {},
        resize: () => {
          this.swiper.update();
        },
      },
    };

    this.init();
  }

  init() {
    this.swiper = new Swiper(".event-swiper", this.swiperConfig);
  }
}

// About Component
class About {
  constructor(aboutData) {
    this.popup = document.querySelector(".about-popup");
    this.overlay = document.querySelector(".about-popup-overlay");
    this.closeBtn = document.querySelector(".about-popup-close");
    this.aboutItems = document.querySelectorAll(".about-content-item");
    this.popupIcon = document.querySelector(".about-popup-icon img");
    this.popupTitle = document.querySelector(".about-popup-title");
    this.popupDescription = document.querySelector(".about-popup-description");
    this.popupList = document.querySelector(".about-popup-list");

    this.aboutData = aboutData;

    this.init();
  }

  init() {
    this.aboutItems.forEach((item) => {
      item.addEventListener("click", () => {
        const id = item.getAttribute("data-id");
        const data = this.aboutData[id];
        if (data) {
          this.showPopup(item, data);
        }
      });
    });

    this.closeBtn.addEventListener("click", () => this.hidePopup());
    this.overlay.addEventListener("click", () => this.hidePopup());
    document.addEventListener("keydown", (e) => {
      if (e.key === "Escape") this.hidePopup();
    });
  }

  showPopup(item, data) {
    console.log(item, data, "debug");
    const list = data?.list || [];
    this.popupTitle.textContent = data.title;
    list.forEach((item) => {
      const listItem = document.createElement("div");
      listItem.classList.add("about-popup-list-item");
      listItem.innerHTML = `
        <div class="about-popup-list-item-icon">
          <img src="${item.icon}" alt="${item.title}">
        </div>
        <p class="about-popup-list-item-title">${item.title}</p>
      `;
      this.popupList.appendChild(listItem);
    });

    this.popup.classList.add("active");
  }

  hidePopup() {
    this.popup.classList.remove("active");
    this.popupList.innerHTML = "";
  }

  destroy() {
    this.aboutItems.forEach((item) => {
      item.removeEventListener("click", () => {});
    });
    this.closeBtn.removeEventListener("click", () => {});
    this.overlay.removeEventListener("click", () => {});
    document.removeEventListener("keydown", () => {});
    this.popup.removeEventListener("transitionend", () => {});
    this.popupList.innerHTML = "";
  }
}

// Video Component
class Video {
  constructor(videos) {
    this.videoItems = document.querySelectorAll(".video-content-item");
    this.popup = null;
    this.videos = videos;
    this.init();
  }

  init() {
    this.createPopup();
    this.setupVideoItems();
    this.addEventListeners();
  }

  createPopup() {
    const popup = document.createElement("div");
    popup.className = "video-popup";
    popup.innerHTML = `
      <div class="video-popup-overlay"></div>
      <div class="video-popup-content">
        <div class="video-popup-close">×</div>
        <div class="video-popup-iframe"></div>
      </div>
    `;
    document.body.appendChild(popup);
    this.popup = popup;
  }

  setupVideoItems() {
    const container = document.querySelector(".video-content");
    container.innerHTML = "";

    this.videos.forEach((video) => {
      const item = document.createElement("div");
      item.className = "video-content-item";
      item.setAttribute("data-video-id", video.youtubeId);

      item.innerHTML = `
        <div class="video-content-item-image">
          <img src="https://img.youtube.com/vi/${video.youtubeId}/maxresdefault.jpg" alt="${video.title}">
        </div>
        <div class="video-content-item-title">
          <h3>${video.title}</h3>
        </div>
      `;

      container.appendChild(item);
    });

    this.videoItems = document.querySelectorAll(".video-content-item");
  }

  addEventListeners() {
    this.videoItems.forEach((item) => {
      item.addEventListener("click", () => {
        const videoId = item.getAttribute("data-video-id");
        this.showVideo(videoId);
      });
    });

    this.popup
      .querySelector(".video-popup-close")
      .addEventListener("click", () => {
        this.hideVideo();
      });

    this.popup
      .querySelector(".video-popup-overlay")
      .addEventListener("click", () => {
        this.hideVideo();
      });
  }

  showVideo(videoId) {
    const iframe = document.createElement("iframe");
    iframe.src = `https://www.youtube.com/embed/${videoId}?autoplay=1`;
    iframe.allow =
      "accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture";
    iframe.allowFullscreen = true;

    const container = this.popup.querySelector(".video-popup-iframe");
    container.innerHTML = "";
    container.appendChild(iframe);

    document.body.classList.add("popup-open");
    this.popup.classList.add("active");
  }

  hideVideo() {
    document.body.classList.remove("popup-open");
    this.popup.classList.remove("active");
    const container = this.popup.querySelector(".video-popup-iframe");
    container.innerHTML = "";
  }
}

// Podcast Component
class Podcast {
  constructor(podcastData) {
    this.podcastData = podcastData;
    this.currentAudio = null;
    this.init();
  }

  init() {
    this.setupPodcastItems();
    this.addEventListeners();
  }

  setupPodcastItems() {
    const container = document.querySelector(".podcast-content");
    container.innerHTML = "";

    this.podcastData.forEach((podcast) => {
      const item = document.createElement("div");
      item.className = "podcast-item";
      item.setAttribute("data-id", podcast.id);

      item.innerHTML = `
        <div class="podcast-item-image">
          <img src="${podcast.image}" alt="${podcast.title}">
        </div>
        <div class="podcast-item-content">
          <div class="podcast-item-info">
            <div class="podcast-image-mobile">
              <img src="${podcast.image}" alt="${podcast.title}">
              <h5 class="podcast-item-title">${podcast.title}</h5>
            </div>
            <div class="podcast-item-subtitle">${podcast.subtitle}</div>
          </div>
          <div class="podcast-item-player">
            <div class="podcast-item-play" data-audio="${podcast.audioUrl}">
              <img src="images/play.svg" alt="Play">
            </div>
            <div class="podcast-item-progress">
                <span class="podcast-time-current">0:00</span>
                <div class="podcast-progress-bar">
                  <div class="podcast-progress-filled"></div>
                </div>
                <span class="podcast-time-duration">Loading...</span>
            </div>
            <div class="podcast-item-volumn">
              <img src="images/volume.svg" alt="Volume">
              <div class="volume-slider">
                <div class="volume-slider-track">
                  <div class="volume-slider-fill" style="height: 100%"></div>
                  <div class="volume-slider-handle" style="bottom: 90%"></div>
                </div>
              </div>
            </div>
          </div>
          <audio class="podcast-audio" src="${podcast.audioUrl}" preload="metadata"></audio>
        </div>
      `;

      container.appendChild(item);
    });
  }

  addEventListeners() {
    const playButtons = document.querySelectorAll(".podcast-item-play");
    const audioElements = document.querySelectorAll(".podcast-audio");
    const volumeSliders = document.querySelectorAll(".volume-slider-track");

    volumeSliders.forEach((slider, index) => {
      const audio = audioElements[index];
      const fill = slider.querySelector(".volume-slider-fill");
      const handle = slider.querySelector(".volume-slider-handle");

      audio.volume = 1;

      const updateVolume = (e) => {
        const rect = slider.getBoundingClientRect();
        let volume = 1 - (e.clientY - rect.top) / rect.height;

        volume = Math.max(0, Math.min(1, volume));
        audio.volume = volume;

        fill.style.height = `${volume * 100}%`;
        handle.style.bottom = `${volume * 90}%`;
      };

      slider.addEventListener("mousedown", (e) => {
        updateVolume(e);

        const onMouseMove = (e) => {
          updateVolume(e);
        };

        const onMouseUp = () => {
          document.removeEventListener("mousemove", onMouseMove);
          document.removeEventListener("mouseup", onMouseUp);
        };

        document.addEventListener("mousemove", onMouseMove);
        document.addEventListener("mouseup", onMouseUp);
      });

      const volumeIcon = slider
        .closest(".podcast-item-volumn")
        .querySelector("img");
      let lastVolume = 1;

      volumeIcon.addEventListener("click", (e) => {
        e.stopPropagation();
        if (audio.volume > 0) {
          lastVolume = audio.volume;
          audio.volume = 0;
          fill.style.height = "0%";
          handle.style.bottom = "0%";
        } else {
          audio.volume = lastVolume;
          fill.style.height = `${lastVolume * 100}%`;
          handle.style.bottom = `${lastVolume * 90}%`;
        }
      });
    });

    audioElements.forEach((audio) => {
      audio.addEventListener("loadedmetadata", () => {
        const duration = this.formatTime(audio.duration);
        audio
          .closest(".podcast-item")
          .querySelector(".podcast-time-duration").textContent = duration;
      });
    });

    playButtons.forEach((button, index) => {
      button.addEventListener("click", () => {
        const audio = audioElements[index];

        if (this.currentAudio && this.currentAudio !== audio) {
          this.currentAudio.pause();
          this.currentAudio.currentTime = 0;
          this.currentAudio
            .closest(".podcast-item")
            .querySelector(".podcast-item-play img").src = "images/play.svg";
        }

        if (audio.paused) {
          audio.play();
          button.querySelector("img").src = "images/pause.svg";
          this.currentAudio = audio;
        } else {
          audio.pause();
          button.querySelector("img").src = "images/play.svg";
          this.currentAudio = null;
        }
      });

      const audio = audioElements[index];
      const progressBar = audio
        .closest(".podcast-item")
        .querySelector(".podcast-progress-filled");
      const progressBarContainer = audio
        .closest(".podcast-item")
        .querySelector(".podcast-progress-bar");
      const currentTime = audio
        .closest(".podcast-item")
        .querySelector(".podcast-time-current");

      progressBarContainer.addEventListener("click", (e) => {
        const rect = progressBarContainer.getBoundingClientRect();
        const percent = (e.clientX - rect.left) / rect.width;
        audio.currentTime = percent * audio.duration;
      });

      audio.addEventListener("timeupdate", () => {
        const percent = (audio.currentTime / audio.duration) * 100;
        progressBar.style.width = percent + "%";
        currentTime.textContent = this.formatTime(audio.currentTime);
      });

      audio.addEventListener("ended", () => {
        button.querySelector("img").src = "images/play.svg";
        this.currentAudio = null;
        progressBar.style.width = "0%";
        currentTime.textContent = "0:00";
      });
    });
  }

  formatTime(seconds) {
    const minutes = Math.floor(seconds / 60);
    seconds = Math.floor(seconds % 60);
    return `${minutes}:${seconds.toString().padStart(2, "0")}`;
  }

  destroy() {
    if (this.currentAudio) {
      this.currentAudio.pause();
      this.currentAudio = null;
    }
  }
}

// Service Contact Component
class ServiceContact {
  constructor() {
    this.modal = document.querySelector(".service-contact-modal");
    this.overlay = document.querySelector(".service-contact-modal-overlay");
    this.closeBtn = document.querySelector(".service-contact-modal-close");
    this.buttons = document.querySelectorAll(".service-contact-item-button");
    this.modalTitle = document.querySelector(".service-contact-modal-title");
    this.modalDescription = document.querySelector(
      ".service-contact-modal-description"
    );
    this.modalList = document.querySelector(".service-contact-modal-list");

    this.serviceData = {
      1: {
        title: "Mầm non & Trường Học",
        description:
          "Diễn giả & Tập huấn nâng cao phát triển chuyên môn về Tâm lý – Phát triển Nhi theo yêu cầu.",
        list: [
          {
            title:
              "Đào tạo nâng cao về Tâm lý - Phát triển Nhi cho đội ngũ giáo viên",
            icon: "images/heart.png",
          },
          {
            title: "Diễn giả Hội thảo dành cho Phụ huynh của trường",
            icon: "images/heart.png",
          },
        ],
      },
      2: {
        title: "Tổ chức và doanh nghiệp",
        description:
          "Đào tạo nội bộ, nâng cao chất lượng cuộc sống và tinh thần cho nhân sự trong vai trò làm cha mẹ.",
        list: [
          {
            title:
              "Đào tạo nâng cao về Tâm lý - Phát triển Nhi cho đội ngũ giáo viên",
            icon: "images/heart.png",
          },
          {
            title: "Diễn giả Hội thảo dành cho Phụ huynh của trường",
            icon: "images/heart.png",
          },
        ],
      },
      3: {
        title: "Nhãn hàng & thương mại",
        description:
          "Đồng hành cùng lan tỏa thông điệp 'Cha mẹ vui vẻ - Con trẻ hạnh phúc'.",
        list: [
          {
            title:
              "Đào tạo nâng cao về Tâm lý - Phát triển Nhi cho đội ngũ giáo viên",
            icon: "images/heart.png",
          },
          {
            title: "Diễn giả Hội thảo dành cho Phụ huynh của trường",
            icon: "images/heart.png",
          },
        ],
      },
    };

    this.init();
  }

  init() {
    this.buttons.forEach((button, index) => {
      button.addEventListener("click", () => {
        const id = index + 1;
        const data = this.serviceData[id];
        if (data) {
          this.showModal(data);
        }
      });
    });

    this.closeBtn.addEventListener("click", () => this.hideModal());
    this.overlay.addEventListener("click", () => this.hideModal());
    document.addEventListener("keydown", (e) => {
      if (e.key === "Escape") this.hideModal();
    });
  }

  showModal(data) {
    const list = data?.list || [];
    this.modalTitle.textContent = data.title;
    this.modalDescription.textContent = data.description;
    this.modalList.innerHTML = "";

    list.forEach((item) => {
      const listItem = document.createElement("div");
      listItem.classList.add("service-contact-modal-list-item");
      listItem.innerHTML = `
        <div class="service-contact-modal-list-item-icon">
          <img src="${item.icon}" alt="${item.title}">
        </div>
        <p class="service-contact-modal-list-item-title">${item.title}</p>
      `;
      this.modalList.appendChild(listItem);
    });

    this.modal.classList.add("active");
  }

  hideModal() {
    this.modal.classList.remove("active");
    this.modalList.innerHTML = "";
  }

  destroy() {
    this.buttons.forEach((button) => {
      button.removeEventListener("click", () => {});
    });
    this.closeBtn.removeEventListener("click", () => {});
    this.overlay.removeEventListener("click", () => {});
    document.removeEventListener("keydown", () => {});
    this.modalList.innerHTML = "";
  }
}

// Tab Dropdown Component
class TabDropdown {
  constructor() {
    this.dropdown = document.querySelector(".tab-dropdown-select");
    this.header = this.dropdown.querySelector(".tab-dropdown-header");
    this.selectedText = this.dropdown.querySelector(".tab-dropdown-selected");
    this.options = this.dropdown.querySelectorAll(".tab-dropdown-option");

    this.init();
  }

  init() {
    this.header.addEventListener("click", () => {
      this.dropdown.classList.toggle("active");
    });

    document.addEventListener("click", (e) => {
      if (!this.dropdown.contains(e.target)) {
        this.dropdown.classList.remove("active");
      }
    });

    this.options.forEach((option) => {
      option.addEventListener("click", () => {
        this.selectedText.textContent = option.textContent;

        this.options.forEach((opt) => opt.classList.remove("active"));
        option.classList.add("active");

        this.dropdown.classList.remove("active");
      });
    });
  }

  destroy() {
    this.header.removeEventListener("click", () => {});
    this.options.forEach((option) => {
      option.removeEventListener("click", () => {});
    });
  }
}

// App Initialization
class App {
  constructor() {
    this.modules = {};
    this.initializeModules();
  }

  initializeModules() {
    try {
      window.addEventListener("load", () => {
        this.modules.faq = new FAQ();
        this.modules.testimonials = new Testimonials();
        this.modules.certificate = new Certificate();
        this.modules.gallery = new Gallery();
        this.modules.event = new Event();
        this.modules.about = new About(aboutData);
        this.modules.video = new Video(videoData);
        this.modules.podcast = new Podcast(podcastData);
        this.modules.serviceContact = new ServiceContact();
        this.tabDropdown = new TabDropdown();
      });
    } catch (error) {
      console.error("Error initializing modules:", error);
    }
  }

  destroy() {
    Object.values(this.modules).forEach((module) => {
      if (module && typeof module.destroy === "function") {
        module.destroy();
      }
    });
    this.modules = {};
    this.tabDropdown.destroy();
  }
}

document.addEventListener("DOMContentLoaded", () => {
  new App();
});
