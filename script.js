const aboutData = {
  1: {
    title: "DIR/FLOORTIME®: Coaching Caregivers & Teachers",
    list: [
      {
        title:
          "DIR/FLOORTIME®: Phương pháp DIR/Floortime được sáng lập bởi bác sĩ Stanley Greenspan, đại học Havard và Yale, cùng với tiến sĩ Serena Wieder, đại học New York. Phương pháp này chú trọng vào 6 năng lực phát triển cảm xúc ở tất cả trẻ em, đặc biệt là các em Phổ Tự Kỷ.",
        icon: "images/heart.png",
      },
      {
        title:
          "DIR/FLOORTIME®: Phương pháp DIR/Floortime được sáng lập bởi bác sĩ Stanley Greenspan, đại học Havard và Yale, cùng với tiến sĩ Serena Wieder, đại học New York. Phương pháp này chú trọng vào 6 năng lực phát triển cảm xúc ở tất cả trẻ em, đặc biệt là các em Phổ Tự Kỷ.",
        icon: "images/heart.png",
      },
    ],
  },
  2: {
    title: "Parent-Child Interaction Therapy (PCIT)",
    list: [
      {
        title:
          "DIR/FLOORTIME®: Phương pháp DIR/Floortime được sáng lập bởi bác sĩ Stanley Greenspan, đại học Havard và Yale, cùng với tiến sĩ Serena Wieder, đại học New York. Phương pháp này chú trọng vào 6 năng lực phát triển cảm xúc ở tất cả trẻ em, đặc biệt là các em Phổ Tự Kỷ.",
        icon: "images/heart.png",
      },
      {
        title:
          "DIR/FLOORTIME®: Phương pháp DIR/Floortime được sáng lập bởi bác sĩ Stanley Greenspan, đại học Havard và Yale, cùng với tiến sĩ Serena Wieder, đại học New York. Phương pháp này chú trọng vào 6 năng lực phát triển cảm xúc ở tất cả trẻ em, đặc biệt là các em Phổ Tự Kỷ.",
        icon: "images/heart.png",
      },
    ],
  },
  3: {
    title: "Touchpoints: The How of Child and Family Engagement",
    list: [
      {
        title:
          "DIR/FLOORTIME®: Phương pháp DIR/Floortime được sáng lập bởi bác sĩ Stanley Greenspan, đại học Havard và Yale, cùng với tiến sĩ Serena Wieder, đại học New York. Phương pháp này chú trọng vào 6 năng lực phát triển cảm xúc ở tất cả trẻ em, đặc biệt là các em Phổ Tự Kỷ.",
        icon: "images/heart.png",
      },
      {
        title:
          "DIR/FLOORTIME®: Phương pháp DIR/Floortime được sáng lập bởi bác sĩ Stanley Greenspan, đại học Havard và Yale, cùng với tiến sĩ Serena Wieder, đại học New York. Phương pháp này chú trọng vào 6 năng lực phát triển cảm xúc ở tất cả trẻ em, đặc biệt là các em Phổ Tự Kỷ.",
        icon: "images/heart.png",
      },
    ],
  },
  4: {
    title: "Mentalization-Based Treatment for Children (MBT-C)",
    list: [
      {
        title:
          "DIR/FLOORTIME®: Phương pháp DIR/Floortime được sáng lập bởi bác sĩ Stanley Greenspan, đại học Havard và Yale, cùng với tiến sĩ Serena Wieder, đại học New York. Phương pháp này chú trọng vào 6 năng lực phát triển cảm xúc ở tất cả trẻ em, đặc biệt là các em Phổ Tự Kỷ.",
        icon: "images/heart.png",
      },
      {
        title:
          "DIR/FLOORTIME®: Phương pháp DIR/Floortime được sáng lập bởi bác sĩ Stanley Greenspan, đại học Havard và Yale, cùng với tiến sĩ Serena Wieder, đại học New York. Phương pháp này chú trọng vào 6 năng lực phát triển cảm xúc ở tất cả trẻ em, đặc biệt là các em Phổ Tự Kỷ.",
        icon: "images/heart.png",
      },
    ],
  },
  5: {
    title: "The PLAY Project - Play & Language for Autistic Youngsters",
    list: [
      {
        title:
          "DIR/FLOORTIME®: Phương pháp DIR/Floortime được sáng lập bởi bác sĩ Stanley Greenspan, đại học Havard và Yale, cùng với tiến sĩ Serena Wieder, đại học New York. Phương pháp này chú trọng vào 6 năng lực phát triển cảm xúc ở tất cả trẻ em, đặc biệt là các em Phổ Tự Kỷ.",
        icon: "images/heart.png",
      },
      {
        title:
          "DIR/FLOORTIME®: Phương pháp DIR/Floortime được sáng lập bởi bác sĩ Stanley Greenspan, đại học Havard và Yale, cùng với tiến sĩ Serena Wieder, đại học New York. Phương pháp này chú trọng vào 6 năng lực phát triển cảm xúc ở tất cả trẻ em, đặc biệt là các em Phổ Tự Kỷ.",
        icon: "images/heart.png",
      },
    ],
  },
  6: {
    title: "Accredited Triple P Provider, Levels 2, 3, 4, 5",
    list: [
      {
        title:
          "DIR/FLOORTIME®: Phương pháp DIR/Floortime được sáng lập bởi bác sĩ Stanley Greenspan, đại học Havard và Yale, cùng với tiến sĩ Serena Wieder, đại học New York. Phương pháp này chú trọng vào 6 năng lực phát triển cảm xúc ở tất cả trẻ em, đặc biệt là các em Phổ Tự Kỷ.",
        icon: "images/heart.png",
      },
      {
        title:
          "DIR/FLOORTIME®: Phương pháp DIR/Floortime được sáng lập bởi bác sĩ Stanley Greenspan, đại học Havard và Yale, cùng với tiến sĩ Serena Wieder, đại học New York. Phương pháp này chú trọng vào 6 năng lực phát triển cảm xúc ở tất cả trẻ em, đặc biệt là các em Phổ Tự Kỷ.",
        icon: "images/heart.png",
      },
    ],
  },
  7: {
    title: "The Incredible Years: Parents, Teachers, and Children Training",
    list: [
      {
        title:
          "DIR/FLOORTIME®: Phương pháp DIR/Floortime được sáng lập bởi bác sĩ Stanley Greenspan, đại học Havard và Yale, cùng với tiến sĩ Serena Wieder, đại học New York. Phương pháp này chú trọng vào 6 năng lực phát triển cảm xúc ở tất cả trẻ em, đặc biệt là các em Phổ Tự Kỷ.",
        icon: "images/heart.png",
      },
      {
        title:
          "DIR/FLOORTIME®: Phương pháp DIR/Floortime được sáng lập bởi bác sĩ Stanley Greenspan, đại học Havard và Yale, cùng với tiến sĩ Serena Wieder, đại học New York. Phương pháp này chú trọng vào 6 năng lực phát triển cảm xúc ở tất cả trẻ em, đặc biệt là các em Phổ Tự Kỷ.",
        icon: "images/heart.png",
      },
    ],
  },
  8: {
    title: "Circle of Security Parenting™ (COSP) program facilitator",
    list: [
      {
        title:
          "DIR/FLOORTIME®: Phương pháp DIR/Floortime được sáng lập bởi bác sĩ Stanley Greenspan, đại học Havard và Yale, cùng với tiến sĩ Serena Wieder, đại học New York. Phương pháp này chú trọng vào 6 năng lực phát triển cảm xúc ở tất cả trẻ em, đặc biệt là các em Phổ Tự Kỷ.",
        icon: "images/heart.png",
      },
      {
        title:
          "DIR/FLOORTIME®: Phương pháp DIR/Floortime được sáng lập bởi bác sĩ Stanley Greenspan, đại học Havard và Yale, cùng với tiến sĩ Serena Wieder, đại học New York. Phương pháp này chú trọng vào 6 năng lực phát triển cảm xúc ở tất cả trẻ em, đặc biệt là các em Phổ Tự Kỷ.",
        icon: "images/heart.png",
      },
    ],
  },
  9: {
    title: "Trauma-Focused Cognitive Behavioral Therapy (TF-CBT)",
    list: [
      {
        title:
          "DIR/FLOORTIME®: Phương pháp DIR/Floortime được sáng lập bởi bác sĩ Stanley Greenspan, đại học Havard và Yale, cùng với tiến sĩ Serena Wieder, đại học New York. Phương pháp này chú trọng vào 6 năng lực phát triển cảm xúc ở tất cả trẻ em, đặc biệt là các em Phổ Tự Kỷ.",
        icon: "images/heart.png",
      },
      {
        title:
          "DIR/FLOORTIME®: Phương pháp DIR/Floortime được sáng lập bởi bác sĩ Stanley Greenspan, đại học Havard và Yale, cùng với tiến sĩ Serena Wieder, đại học New York. Phương pháp này chú trọng vào 6 năng lực phát triển cảm xúc ở tất cả trẻ em, đặc biệt là các em Phổ Tự Kỷ.",
        icon: "images/heart.png",
      },
    ],
  },
  10: {
    title: "ZERO TO THREE: Professional Development",
    list: [
      {
        title:
          "DIR/FLOORTIME®: Phương pháp DIR/Floortime được sáng lập bởi bác sĩ Stanley Greenspan, đại học Havard và Yale, cùng với tiến sĩ Serena Wieder, đại học New York. Phương pháp này chú trọng vào 6 năng lực phát triển cảm xúc ở tất cả trẻ em, đặc biệt là các em Phổ Tự Kỷ.",
        icon: "images/heart.png",
      },
      {
        title:
          "DIR/FLOORTIME®: Phương pháp DIR/Floortime được sáng lập bởi bác sĩ Stanley Greenspan, đại học Havard và Yale, cùng với tiến sĩ Serena Wieder, đại học New York. Phương pháp này chú trọng vào 6 năng lực phát triển cảm xúc ở tất cả trẻ em, đặc biệt là các em Phổ Tự Kỷ.",
        icon: "images/heart.png",
      },
    ],
  },
};

// Utility functions
const Utils = {
  debounce(func, wait) {
    let timeout;
    return function executedFunction(...args) {
      const later = () => {
        clearTimeout(timeout);
        func(...args);
      };
      clearTimeout(timeout);
      timeout = setTimeout(later, wait);
    };
  },

  isMobile() {
    return window.innerWidth <= 768;
  },
};

// FAQ Component
class FAQ {
  constructor() {
    this.faqItems = document.querySelectorAll(".faq-item");
    this.init();
  }

  init() {
    this.faqItems.forEach((item) => {
      const question = item.querySelector(".faq-question");
      question.addEventListener("click", () => this.toggleFAQ(item));
    });
  }

  toggleFAQ(item) {
    const isActive = item.classList.contains("active");
    const answer = item.querySelector(".faq-answer");

    this.faqItems.forEach((otherItem) => {
      if (otherItem !== item && otherItem.classList.contains("active")) {
        otherItem.classList.remove("active");
        otherItem.querySelector(".faq-answer").style.maxHeight = "0";
      }
    });

    if (!isActive) {
      item.classList.add("active");
      const height = answer.querySelector("p").offsetHeight + 40;
      answer.style.maxHeight = `${height}px`;
    } else {
      item.classList.remove("active");
      answer.style.maxHeight = "0";
    }
  }
}

// Testimonials Component
class Testimonials {
  constructor() {
    this.swiperConfig = {
      slidesPerView: "auto",
      spaceBetween: 24,
      loop: false,
      // autoplay: {
      //   delay: 30000,
      //   disableOnInteraction: false,
      //   stopOnLastSlide: true,
      // },
      navigation: {
        nextEl: ".button-next",
        prevEl: ".button-prev",
      },
      speed: 800,
      effect: "slide",
      observer: true,
      observeParents: true,
      resizeObserver: true,
      breakpoints: {
        320: {
          slidesPerView: 1,
          spaceBetween: 16,
        },
        768: {
          slidesPerView: 1.5,
          spaceBetween: 20,
        },
        1024: {
          slidesPerView: 2,
          spaceBetween: 24,
        },
        1200: {
          slidesPerView: 2.2,
          spaceBetween: 24,
        },
      },
      centeredSlides: false,
      grabCursor: true,
      on: {
        init: () => {},
        slideChange: () => {},
        resize: () => {
          this.swiper.update();
          this.updateSwiperContainer();
        },
      },
    };

    this.init();
  }

  init() {
    this.swiper = new Swiper(".testimonials-swiper", this.swiperConfig);
    this.updateSwiperContainer();
    this.setupResizeListener();
  }

  updateSwiperContainer() {
    const container = document.querySelector(".testimonials-swiper");
    const windowWidth = window.innerWidth;
    const containerWidth = document.querySelector(".container").offsetWidth;

    if (windowWidth <= 768) {
      container.style.width = "100%";
      container.style.paddingRight = "0";
    } else {
      const extraWidth = (windowWidth - containerWidth) / 2;
      container.style.width = `calc(100% + ${extraWidth}px)`;
      container.style.paddingRight = `${extraWidth}px`;
    }
  }

  setupResizeListener() {
    window.addEventListener(
      "resize",
      Utils.debounce(() => {
        this.swiper.update();
        this.updateSwiperContainer();
      }, 250)
    );
  }
}

// Certificate Component
class Certificate {
  constructor() {
    this.swiperConfig = {
      slidesPerView: 1,
      spaceBetween: 24,
      loop: false,
      pagination: {
        el: ".certificate-pagination",
        clickable: true,
        type: "bullets",
      },
      navigation: {
        nextEl: ".certificate-next",
        prevEl: ".certificate-prev",
      },
      speed: 800,
      observer: true,
      observeParents: true,
      resizeObserver: true,
      breakpoints: {
        768: {
          slidesPerView: 2,
          spaceBetween: 24,
        },
        1024: {
          slidesPerView: 3,
          spaceBetween: 24,
        },
      },
      on: {
        init: () => {},
        slideChange: () => {},
        resize: () => {
          this.swiper.update();
        },
      },
    };

    this.init();
  }

  init() {
    this.swiper = new Swiper(".certificate-swiper", this.swiperConfig);
  }
}

// Gallery Component
class Gallery {
  constructor() {
    this.swiperConfig = {
      slidesPerView: "auto",
      spaceBetween: 32,
      loop: false,
      navigation: {
        nextEl: ".button-next-gallery",
        prevEl: ".button-prev-gallery",
      },
      speed: 800,
      observer: true,
      observeParents: true,
      resizeObserver: true,
      breakpoints: {
        768: {
          spaceBetween: 24,
        },
      },
      on: {
        init: () => {},
        slideChange: () => {},
        resize: () => {
          this.swiper.update();
        },
      },
    };

    this.init();
  }

  init() {
    this.swiper = new Swiper(".gallery-swiper", this.swiperConfig);
  }
}

// Event Component
class Event {
  constructor() {
    this.swiperConfig = {
      slidesPerView: 1,
      spaceBetween: 16,
      loop: false,
      pagination: {
        el: ".event-pagination",
        clickable: true,
        type: "bullets",
      },
      navigation: {
        nextEl: ".button-next-event",
        prevEl: ".button-prev-event",
      },
      speed: 1000,
      observer: true,
      observeParents: true,
      resizeObserver: true,
      on: {
        init: () => {},
        slideChange: () => {},
        resize: () => {
          this.swiper.update();
        },
      },
    };

    this.init();
  }

  init() {
    this.swiper = new Swiper(".event-swiper", this.swiperConfig);
  }
}

// About Component
class About {
  constructor(aboutData) {
    this.popup = document.querySelector(".about-popup");
    this.overlay = document.querySelector(".about-popup-overlay");
    this.closeBtn = document.querySelector(".about-popup-close");
    this.aboutItems = document.querySelectorAll(".about-content-item");
    this.popupIcon = document.querySelector(".about-popup-icon img");
    this.popupTitle = document.querySelector(".about-popup-title");
    this.popupDescription = document.querySelector(".about-popup-description");
    this.popupList = document.querySelector(".about-popup-list");

    this.aboutData = aboutData;

    this.init();
  }

  init() {
    this.aboutItems.forEach((item) => {
      item.addEventListener("click", () => {
        const id = item.getAttribute("data-id");
        const data = this.aboutData[id];
        if (data) {
          this.showPopup(item, data);
        }
      });
    });

    this.closeBtn.addEventListener("click", () => this.hidePopup());
    this.overlay.addEventListener("click", () => this.hidePopup());
    document.addEventListener("keydown", (e) => {
      if (e.key === "Escape") this.hidePopup();
    });
  }

  showPopup(item, data) {
    console.log(item, data, "debug");
    const list = data?.list || [];
    this.popupTitle.textContent = data.title;
    list.forEach((item) => {
      const listItem = document.createElement("div");
      listItem.classList.add("about-popup-list-item");
      listItem.innerHTML = `
        <div class="about-popup-list-item-icon">
          <img src="${item.icon}" alt="${item.title}">
        </div>
        <p class="about-popup-list-item-title">${item.title}</p>
      `;
      this.popupList.appendChild(listItem);
    });

    this.popup.classList.add("active");
  }

  hidePopup() {
    this.popup.classList.remove("active");
    this.popupList.innerHTML = "";
    document.body.style.overflow = "";
  }

  destroy() {
    this.aboutItems.forEach((item) => {
      item.removeEventListener("click", () => {});
    });
    this.closeBtn.removeEventListener("click", () => {});
    this.overlay.removeEventListener("click", () => {});
    document.removeEventListener("keydown", () => {});
    this.popup.removeEventListener("transitionend", () => {});
    this.popupList.innerHTML = "";
  }
}

// App Initialization
class App {
  constructor() {
    this.modules = {};
    this.initializeModules();
  }

  initializeModules() {
    try {
      window.addEventListener("load", () => {
        this.modules.faq = new FAQ();
        this.modules.testimonials = new Testimonials();
        this.modules.certificate = new Certificate();
        this.modules.gallery = new Gallery();
        this.modules.event = new Event();
        this.modules.about = new About(aboutData);
      });
    } catch (error) {
      console.error("Error initializing modules:", error);
    }
  }

  destroy() {
    Object.values(this.modules).forEach((module) => {
      if (module && typeof module.destroy === "function") {
        module.destroy();
      }
    });
    this.modules = {};
  }
}

document.addEventListener("DOMContentLoaded", () => {
  new App();
});
